# 2020-12-06 (日)

## ZeroSSL

- https://zerossl.com/
- [無料の SSL 証明書が得られる ZeroSSL を使ってみた](https://zenn.dev/mattn/articles/b2c4c92c9116b1)
- ACME(Automated Certificate Management Environment): Webサーバと認証局との間の相互作用を自動化するための通信プロトコル
- [Introducing another free CA as an alternative to Let's Encrypt](https://scotthelme.co.uk/introducing-another-free-ca-as-an-alternative-to-lets-encrypt/)

### acme.sh

- https://github.com/acmesh-official/acme.sh
- [ZeroSSL](https://github.com/acmesh-official/acme.sh/wiki/ZeroSSL.com-CA)

### Lego: go-acme

- https://go-acme.github.io/lego/


`/home/ubuntu/dev/lego/update.sh`:

~~~bash
#!/bin/bash

ACCESS_KEY=ZeroSSLのAPIアクセスキー
JSON=$(curl -s -X POST "https://api.zerossl.com/acme/eab-credentials?access_key=$ACCESS_KEY")
EAB_KEY=$(echo "$JSON" | jq -r .eab_kid)
EAB_HMAC_KEY=$(echo "$JSON" | jq -r .eab_hmac_key)

/usr/local/bin/lego \
        --http.webroot /var/www/ドメイン名 \
        --path /etc/zerossl \
        --http \
    --eab --kid "$EAB_KEY" --hmac "$EAB_HMAC_KEY" \
    --server "https://acme.zerossl.com/v2/DV90" \
    --email "メールアドレス" \
    --domains "ドメイン名" \
    -a renew
~~~


`/etc/sudoers.d/lego-update`:

~~~bash
ubuntu ALL=(ALL) NOPASSWD: /home/ubuntu/dev/lego/update.sh
~~~

`crontab -e`:

~~~bash
4 0 * * 0 sudo /home/ubuntu/dev/lego/update.sh
~~~